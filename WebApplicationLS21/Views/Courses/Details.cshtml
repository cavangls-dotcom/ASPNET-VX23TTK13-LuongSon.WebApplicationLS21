@model WebApplicationLS21.Models.Course

@{
    ViewData["Title"] = "Chi tiết khóa học";
}

<div class="container mt-4">
    <h2 class="mb-4 text-center">📘 Chi tiết khóa học</h2>

    <div class="card shadow p-4">
        <h4 class="mb-3">@Model.Title</h4>

        <dl class="row">
            <dt class="col-sm-3">Mã khóa học</dt>
            <dd class="col-sm-9">@Model.CourseID</dd>

            <dt class="col-sm-3">Danh mục</dt>
            <dd class="col-sm-9">@Model.Category</dd>

            <dt class="col-sm-3">Giảng viên</dt>
            <dd class="col-sm-9">@Model.Instructor?.FullName</dd>

            <dt class="col-sm-3">Thời lượng</dt>
            <dd class="col-sm-9">@Model.DurationHours giờ</dd>

            <dt class="col-sm-3">Giá</dt>
            <dd class="col-sm-9">@String.Format("{0:N0} VNĐ", Model.Price)</dd>

            <dt class="col-sm-3">Mô tả</dt>
            <dd class="col-sm-9">@Model.Description</dd>
        </dl>

        <hr />

        <h5 class="mt-3">📄 File nội dung khóa học</h5>

        @if (!string.IsNullOrEmpty(Model.ContentFilePath))
        {
            <p>
                <a class="btn btn-success" href="@Model.ContentFilePath" download>
                    ⬇ Tải xuống file
                </a>
            </p>

            @if (Model.ContentFilePath.EndsWith(".pdf"))
            {
                <div class="mt-3">
                    <iframe src="@Model.ContentFilePath" width="100%" height="600px" style="border:1px solid #ccc;"></iframe>
                </div>
            }
        }
        else
        {
            <p class="text-danger">Chưa có file nội dung cho khóa học này.</p>
        }

        <hr />

        <div class="mt-3">
            <a class="btn btn-warning" asp-action="Edit" asp-route-id="@Model.CourseID">✏ Sửa</a>
            <a class="btn btn-secondary" asp-action="Index">⬅ Quay lại danh sách</a>
        </div>
        <hr />

        <!-- ============================= -->
        <!--    DANH SÁCH ĐÁNH GIÁ        -->
        <!-- ============================= -->
        <h3 class="mt-4">⭐ Đánh giá khóa học</h3>

        @if (Model.Reviews != null && Model.Reviews.Any())
        {
            foreach (var r in Model.Reviews.OrderByDescending(r => r.CreatedAt))
            {
                <div class="border p-3 rounded mb-2">
                    <strong>@r.Rating ⭐</strong>
                    <br />
                    <span>@r.Comment</span>
                    <br />
                    <small class="text-muted">
                        Ngày: @r.CreatedAt.ToString("dd/MM/yyyy")
                    </small>
                </div>
            }
        }
        else
        {
            <p class="text-muted">Chưa có đánh giá nào.</p>
        }

        <hr />

        <!-- ============================= -->
        <!--    FORM GỬI ĐÁNH GIÁ         -->
        <!-- ============================= -->
        <h4 class="mt-3">📝 Thêm đánh giá</h4>

        <form asp-controller="Reviews" asp-action="Create" method="post">
            <input type="hidden" name="CourseID" value="@Model.CourseID" />

            <label class="fw-bold">Điểm đánh giá (1–5):</label>
            <input type="number"
                   name="Rating"
                   min="1"
                   max="5"
                   required
                   class="form-control" />

            <label class="fw-bold mt-2">Nhận xét:</label>
            <textarea name="Comment" class="form-control"></textarea>

            <button type="submit" class="btn btn-primary mt-3">
                Gửi đánh giá
            </button>
        </form>

    </div>
</div>